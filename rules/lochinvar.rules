rule "Calculate Lochinvar Delta T"
when
    Item Boiler_Outlet_Temp changed or
    Item Boiler_Inlet_Temp changed
then
    // Check if both items have valid states (not NULL or UNDEF)
    if (Boiler_Outlet_Temp.state instanceof Number && Boiler_Inlet_Temp.state instanceof Number) {
        
        // Get values as floats
        var float outlet = (Boiler_Outlet_Temp.state as Number).floatValue
        var float inlet = (Boiler_Inlet_Temp.state as Number).floatValue
        
        // Calculate Delta
        var float delta = outlet - inlet
        
        // Post update (ensure no negative values if sensors are reading odd during startup)
        if (delta < 0) {
            Lochinvar_DeltaT.postUpdate(0)
        } else {
            Lochinvar_DeltaT.postUpdate(delta)
        }
    }
end